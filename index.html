
<!DOCTYPE HTML PUBLIC> 
<html lang="en"> 
<head> 
<meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0">
  <meta http-equiv="expires" content="Sat, 31 Oct 2014 00:00:00 GMT">
  <meta http-equiv="pragma" content="no-cache">
<script src="sorttable.js"></script>
<script src="plotly-latest.min.js"></script>


<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
<title>Item table for Overwatch</title> 
<style>
td {
padding-left: 3px;
padding-right: 7px;
padding-top: 3px;
padding-bottom: 2px;
}
table {
    border-collapse: collapse;
}
table, th, td {
   border: 1px solid black;
	font-size:16px;
}
tr:hover {background-color: #f5f5f5}

table th
{
padding-right:30px;
}

body {
font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
font-size:18px;
line-height:1.42857143;
color:#333;
background-color:#fff;
}

.common  {
color: #3a3a3a ;

}

.rare {
color: #27dcf4 ;

}
.epic  {
color: #f426f0 ;

}

.legendary  {
color: #f4af25 ;

}
.column-left{ float: left; width: 250px; }
.column-center{ float: left; width: 250px; }
.column-right{ display: inline-block; width: 250px; }

input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none; 
  margin: 0; 
}

table.sortable tbody {
    counter-reset: sortabletablescope;
}
table.sortable thead tr::before {
    content: "";
    display: table-cell;
	border: 1px solid black;
	font-size:16px;
}
table.sortable tbody tr::before {
    content: counter(sortabletablescope);
    counter-increment: sortabletablescope;
    display: table-cell;
	border: 1px solid black;
	font-size:16px;
}


/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}


a {
font-size:14px;
   color: #6666ff;
   text-decoration: none; // changed from text-decoration:underline
}
a:hover {
   color: #3333ff;
   text-decoration: underline; // changed from text:decoration:none
}

</style>
</head> 
<body> 
<a href="#" id='hBtn'>Show Help</a> - 
<a href="#" id='fBtn'>Show Filters</a> - 
<a href="#" id='oBtn'>Show Simulation Options</a> - 
<a href="#" id='sBtn'>Show Spending Strats</a> - 
<a href="mailto:billfreeman44@yahoo.com?Subject=Loot-Box%20websit">Contact/Feedback</a> 
<br>
<br>


<div class="container">
Show items for: <select id="herodisplay" onclick="updateTable();">
    <option value="1">Ana</option>
    <option value="2">Bastion</option>
    <option value="3">Dva</option>
    <option value="4">Genji</option>
    <option value="5">Hanzo</option>
    <option value="6">Junkrat</option>
    <option value="7">Lucio</option>
    <option value="8">Mccree</option>
    <option value="9">Mei</option>
    <option value="10">Mercy</option>
    <option value="11">Orisa</option>
    <option value="12">Pharah</option>
    <option value="13">Reaper</option>
    <option value="14">Reinhardt</option>
    <option value="15">Roadhog</option>
    <option value="16">Soldier-76</option>
    <option value="17">Sombra</option>
    <option value="18">Symmetra</option>
    <option value="19">Torbjorn</option>
    <option value="10">Tracer</option>
    <option value="21">Widowmaker</option>
    <option value="22">Winston</option>
    <option value="23">Zarya</option>
    <option value="24">Zenyatta</option>
    <option value="25">Icons/Sprays (All)</option>
    <option value="26">EVERYTHING</option>
  </select>
  <br>
</div>



<!-- The Modal -->
<div id="helpModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close" id="hclose">&times;</span>
    <p>

This is a website to simulate 
how many loot boxes it takes to get any selection 
of items in overwatch.  
<ol><li> Select the items that you already have ("have it" column).  
<li> Select the items that you want ("want it" column).
<li> Input the amount of gold you have. 
<li> Click the "start simulation" button and thats it! 
</ol>
<p>
When you click on any check box your selections are saved on a cookie.  When you come back, your selections are restored from the cookie.  Click the "clear saved checks" button to delete your cookie and then reload the page to start fresh.  In addition to a cookie, a link is created that saves your selections.  Bookmark this link to save that particular selection.

</p> 
  </div>

</div>


<div id="filtersModal" class="modal">
  <div class="modal-content">
    <span class="close" id="fclose">&times;</span>
    <p>

<input type="checkbox" id="showSkins" onclick="updateTable();" checked> Show Skins <br>
<input type="checkbox" id="showEmotes" onclick="updateTable();" checked> Show Emotes <br>
<input type="checkbox" id="showIntros" onclick="updateTable();" checked> Show Highlight Intros <br>
<input type="checkbox" id="showPoses" onclick="updateTable();" checked> Show Victory Poses <br>
<input type="checkbox" id="showVoices" onclick="updateTable();" checked> Show Voice Lines <br>
<input type="checkbox" id="showSprays" onclick="updateTable();" checked> Show Sprays <br>
<input type="checkbox" id="showIcons" onclick="updateTable();" checked> Show Icons <br>
<br>
<input type="checkbox" id="showLegs" onclick="updateTable();" checked> Show Legendaries <br>
<input type="checkbox" id="showEpics" onclick="updateTable();" checked> Show Epics <br>
<input type="checkbox" id="showRares" onclick="updateTable();" checked> Show Rares <br>
<input type="checkbox" id="showCommons" onclick="updateTable();" checked> Show Commons <br>
<br>
<input type="checkbox" id="showNonEvent" onclick="updateTable();" checked> Show Non-event items <br>
<input type="checkbox" id="showUprising" onclick="updateTable();"> Show Uprising <br>
<input type="checkbox" id="showEvents" onclick="updateTable();"> Show Other events <br>
<br>
<input type="checkbox" id="showAchievement" onclick="updateTable();"> Show Achievement items <br>
<input type="checkbox" id="showBlizzcon" onclick="updateTable();"> Show Items from Blizzcon <br>
<input type="checkbox" id="showDefaultItems" onclick="updateTable();"> Show Default items <br>
<input type="checkbox" id="showNormals" onclick="updateTable();" checked> Show Normal items <br>
<br>
	</p>
  </div>

</div>


<div id="optionsModal" class="modal">
  <div class="modal-content">
    <span class="close" id="oclose">&times;</span>
    <p>

Max iterations: <input type="number" id="nIterations" value="1500" size="10" style="width: 50px"><br><br>
Max time (sec): <input type="number" id="maxTime" value="1.0" size="10" style="width: 50px"><br>
<br>
Max boxes: <input type="number" id="maxBoxes" value="3500" size="10" style="width: 50px"><br>
<br>
	</p>
  </div>

</div>


<div id="spendingModal" class="modal">
  <div class="modal-content">
    <span class="close" id="sclose">&times;</span>
    <p>
	
<input type="radio" name="spend" value="optimal" onclick="lootBoxesNeeded=[];hideContinueButton();" checked> Optimal spending (buy nothing until you can afford everything)<br>
<input type="radio" name="spend" value="buyHigh" onclick="lootBoxesNeeded=[];hideContinueButton();"> Buy expensive items when you can<br>
<input type="radio" name="spend" value="buyLow" onclick="lootBoxesNeeded=[];hideContinueButton();"> Buy cheap items when you can<br>
<input type="radio" name="spend" value="buyNone" onclick="lootBoxesNeeded=[];hideContinueButton();"> Don't buy anything <br>
<br>

	</p>
  </div>

</div>


<div id="contactModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>

	</p>
  </div>

</div>


<p id='urlArea'></p>
<!--
<button onclick="updateCheckboxes('clearPageHave')">Clear "have it" on this page</button><br> 
<button onclick="updateCheckboxes('clearPageWant')">Clear "want it" on this page</button><br> <br> 

<button onclick="updateCheckboxes('checkPageHave')">Check "have it" on this page</button><br> 
<button onclick="updateCheckboxes('checkPageWant')">Check "want it" on this page</button><br> <br> 

<button onclick="clearCookie()">Clear all "have it"</button><br> 
<button onclick="clearCookie()">Clear all "want it"</button><br> <br> 

<button onclick="clearCookie()">Check all "have it"</button><br> 
<button onclick="clearCookie()">Check all "want it"</button><br> <br> 
 <br>
-->
   </div>
   <div>
	Wanted Commons: <span id='wantedCommons'></span><br>
	Wanted Rares: <span id='wantedRares'></span><br>
	Wanted Epics: <span id='wantedEpics'></span><br>
	Wanted Legendaries: <span id='wantedLegs'></span><br>
	Wanted Icons: <span id='wantedIcons'></span><br>
	Total cost in gold: <span id='goldNeeded'></span><br>
	<br>
</div>

<div id='goldAndButton'>
	Current gold: <input type="number" id="userGold" value="0" size="10" style="width: 50px"><br><br>

	<button onclick="startSimulating()">Start simulation</button>  <button onclick="startSimulating(1)" id='continueSimulation' style='display: none'>Continue simulation</button>  <br><br>
</div>

<div id='simResults' style='display: none; width: 500px;'>
The results are in! On average, it took <b><span id='boxesNeededAvg'>0</span> boxes</b> to get the items you wanted. This is an average, and the actual amount it will take depends on RNGesus!  90 percent of simulations took <b><span id='boxesNeededRange'>0</span> boxes</b> to finish (with a median of <b><span id='boxesNeededMed'>0</span></b>).  The simulation ran for <b><span id='nIterationsOut'>0</span> iterations</b> and took <b><span id='timeTaken'>0</span> Seconds</b>!  <span id='postSimComment' style='color: red;'></span><br>
<br>
   
<br>

</div>


<div id="myDiv" style='width: 900px;'></div>

<script src="item_output.js"></script>
<script>
//table display and selection functions!
var n_items=itemarr.length;

function toggleHelp() {
    var x = document.getElementById('helpDiv');
    if (x.style.display === 'none') {
        x.style.display = 'block';
    } else {
        x.style.display = 'none';
    }
}

function toggleFilters() {
    var x = document.getElementById('filters');
    if (x.style.display === 'none') {
        x.style.display = 'block';
		document.getElementById('options').style.display = 'none';
		document.getElementById('spendingHabits').style.display = 'none';
    } else {
        x.style.display = 'none';
    }
}
function toggleOptions() {
    var x = document.getElementById('options');
    if (x.style.display === 'none') {
        x.style.display = 'block';
		document.getElementById('filters').style.display = 'none';
		document.getElementById('spendingHabits').style.display = 'none';
    } else {
        x.style.display = 'none';
    }
}

function toggleSpendingHabits(){
    var x = document.getElementById('spendingHabits');
    if (x.style.display === 'none') {
        x.style.display = 'block';
		document.getElementById('filters').style.display = 'none';
		document.getElementById('options').style.display = 'none';
    } else {
        x.style.display = 'none';
    }
}


//stuff for checkboxes
//keeps same as checked and disables button
function toggleCheck(checkId,thisId) {
    document.getElementById(checkId).checked = document.getElementById(thisId).checked;
    document.getElementById(checkId).disabled = document.getElementById(thisId).checked;
}

//keeps same as checked and does not disable button
function checkMatch(checkId,thisId) {
    document.getElementById(checkId).checked = document.getElementById(thisId).checked;
}

//update the "ck" value for some item
function addCheckItemArr(num,code){
	if (document.getElementById('h'+num).checked==1){
		itemarr[num].ck=1;
		return
	}
	if (document.getElementById('w'+num).checked==1){
		itemarr[num].ck=2;
		return
	}
	itemarr[num].ck=0;
	return
}

//convert a number code to a rarity string.
function numToRarity(num) {
	if (num == 0){return '-';}
	var rarities=['common','rare','epic','legendary'];
	return rarities[num-1];
}

//convert a number code to a type string.
function numToType(num) {
	var types=['unknown','icons','sprays','skins','emotes','intros','voicelines','poses'];
	return types[num];
}

//convert a number code to an event string.
function numToEvent(num) {
	var events=['-','Halloween-16','Summer-16','Uprising-17','Winter-16','Rooster-17'];
	return events[num]
}

//convert a number code to a hero string.
function numToHero(num) {
	var heroes=['error','ana','bastion','dva','genji',
            'hanzo','junkrat','lucio','mccree',
            'mei','mercy','orisa','pharah','reaper',
            'reinhardt','roadhog','soldier-76','sombra',
            'symmetra','torbjorn','tracer','widowmaker',
            'winston','zarya','zenyatta','all'];
	return heroes[num];
}

//convert a number code to a "special" string.
//num1 = achivement (1 achievement, 2 blizzcon)
//num2 = is true if default item false if not
function numToSpecial(num1,num2) {
	if (num1 == 1) {
	return 'Achievement';
	}
	if (num1 == 2) {
	return 'Blizzcon';
	}
	if (num2 == 1) {
	return 'Default';
	}
	return '-';
}


//outputs a checkbox string... this code is awful.
//inputs are default, achievement, itemNumber, event, have (1=have,0=want)
function outputCheckBox(def,ach,num,eve,hav) {
	var outstr='<input type="checkbox"';
	//its a default item
	if (def) {
		if (hav) {
		outstr+=' id="h'+num+'"';
		} else {
		outstr+=' id="w'+num+'"';
		}
		outstr+=' disabled="true" checked>';
		return outstr;
	}
	
	//its from an achievement
	if (ach) {
		if (hav) {
			outstr+=' id="h'+num+'"';
			outstr+=' onclick="checkMatch(\'w'+num+'\',\'h'+num+'\');makeUrl()"';
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		} else {
			outstr+=' id="w'+num+'"';
			outstr+=' disabled="true"'; 
			
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		}
		return outstr;
	}
	
	//normal item
	if (eve == 0 || eve == 3) {
		if (hav) {
			outstr+=' id="h'+num+'"';
			outstr+=' onclick="toggleCheck(\'w'+num+'\',\'h'+num+'\');addCheckItemArr('+num+',1);makeUrl();updateDesired();lootBoxesNeeded=[];hideContinueButton();"';
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		} else {
			outstr+=' id="w'+num+'" onclick="addCheckItemArr('+num+',2);makeUrl();updateDesired();lootBoxesNeeded=[];hideContinueButton();"';
			if (itemarr[num].ck == 1) {
				outstr+=' disabled="true" checked>';
			} else { 
				if ( itemarr[num].ck == 2){
					outstr+=' checked>';
					} else {
						outstr+='>';
					}
				}
			}
			return outstr;
	} 
	
	//other events
	if (hav) {
		outstr+=' id="h'+num+'"';
		outstr+=' onclick="checkMatch(\'w'+num+'\',\'h'+num+'\');makeUrl();updateDesired();"';
		if (itemarr[num].ck == 1) {
			outstr+=' checked>';
		} else {
			outstr+='>';
		}
	
	} else {
		outstr+=' id="w'+num+'"';
		outstr+='  disabled="true"';
		if (itemarr[num].ck == 1 || itemarr[num].ck == 2) {
			outstr+=' checked>';
		} else {
			outstr+='>';
		}
	
	}
	return outstr;

}

//output a row in the table.
function makeRow(itemNumber) {
	var outputstr='';
	console.log('making row for '+itemNumber)
	outputstr+="<td>"+outputCheckBox(itemarr[itemNumber].de,itemarr[itemNumber].ac,
	itemNumber,itemarr[itemNumber].ev,true)+"</td>";
	outputstr+="<td>"+outputCheckBox(itemarr[itemNumber].de,itemarr[itemNumber].ac,
	itemNumber,itemarr[itemNumber].ev,false)+"</td>";
	outputstr+="<td>"+numToType(itemarr[itemNumber].ty)+"</td>";
	outputstr+="<td class='"+numToRarity(itemarr[itemNumber].ra)+"'>"+itemarr[itemNumber].na+"</td>";
	outputstr+="<td>"+numToRarity(itemarr[itemNumber].ra)+"</td>";
	outputstr+="<td>"+numToEvent(itemarr[itemNumber].ev)+"</td>";
	outputstr+="<td>"+numToSpecial(itemarr[itemNumber].ac,itemarr[itemNumber].de)+"</td>";
	outputstr+="<td>"+itemarr[itemNumber].co+"</td>";
	outputstr+="<td>"+numToHero(itemarr[itemNumber].he)+"</td>";
	return outputstr;
}

//output the hero ID that is selected w/ radio button.
function heroSelected() {
	return document.getElementById('herodisplay').value;
}

//return true if item should be shown based on its type
function showItemType(i) {
	var typestr=numToType(itemarr[i].ty);
	if (typestr == 'icons' && document.getElementById('showIcons').checked == true) {
		return true;
	}
	if (typestr == 'sprays' && document.getElementById('showSprays').checked == true) {
		return true;
	}
	if (typestr == 'skins' && document.getElementById('showSkins').checked == true) {
		return true;
	}
	if (typestr == 'emotes' && document.getElementById('showEmotes').checked == true) {
		return true;
	}
	if (typestr == 'intros' && document.getElementById('showIntros').checked == true) {
		return true;
	}
	if (typestr == 'voicelines' && document.getElementById('showVoices').checked == true) {
		return true;
	}
	if (typestr == 'poses' && document.getElementById('showPoses').checked == true) {
		return true;
	}
	return false;
}

//return true if item should be shown based on its event
function showEvent(i) {
	var eventstr=numToEvent(itemarr[i].ev);
	if (eventstr == 'Uprising-17' && document.getElementById('showUprising').checked == true) {
		return true;
	}
	if (eventstr != '-' && eventstr != 'Uprising-17' && document.getElementById('showEvents').checked == true) {
		return true;
	}
	if (eventstr == '-' && document.getElementById('showNonEvent').checked == true) {
		return true;
	}
	return false;
}

//return true if item should be shown based on its achievement or blizcon or default
function showSpecial(i) {
	var specialstr=numToSpecial(itemarr[i].ac,itemarr[i].de);
	if (specialstr == 'Blizzcon' && document.getElementById('showBlizzcon').checked == true) {
		return true;
	}
	if (specialstr == 'Achievement' && document.getElementById('showAchievement').checked == true) {
		return true;
	}
	if (specialstr == 'Default' && document.getElementById('showDefaultItems').checked == true) {
		return true;
	}
	if (specialstr == '-' && document.getElementById('showNormals').checked == true) {
		return true;
	}
	return false;
}

//return true if item should be shown based on its achievement or blizcon or default
function showRarity(i) {
	var specialstr=numToRarity(itemarr[i].ra);
	if (specialstr == 'legendary' && document.getElementById('showLegs').checked == true) {
		return true;
	}
	if (specialstr == 'epic' && document.getElementById('showEpics').checked == true) {
		return true;
	}
	if (specialstr == 'rare' && document.getElementById('showRares').checked == true) {
		return true;
	}
	if (specialstr == 'common' && document.getElementById('showCommons').checked == true) {
		return true;
	}
	return false;
}

function updateCheckboxes(code) {
	var displayHeroId=heroSelected();
	for (i=0;i<itemarr.length;i++) {
		if (code == 'clearPageWant'){
			if (displayHeroId ==  itemarr[i].he || displayHeroId == 26){
				if (itemarr[i].ck==2 && showItemType(i) && showEvent(i) && showSpecial(i) && showRarity(i)){itemarr[i].ck=0;}
			document.getElementById( "wantLink" ).setAttribute( "onClick", "javascript: updateCheckboxes('checkPageWant');lootBoxesNeeded=[];hideContinueButton();" );
			}
		}
		if (code == 'clearPageHave'){
			if (displayHeroId ==  itemarr[i].he || displayHeroId == 26){
				if (itemarr[i].ck==1 && showItemType(i) && showEvent(i) && showSpecial(i) && showRarity(i)){itemarr[i].ck=0;}
			}			
		}
		if (code == 'checkPageWant'){
			if (displayHeroId ==  itemarr[i].he || displayHeroId == 26){
				if (showItemType(i) && showEvent(i) && showSpecial(i) && showRarity(i)){itemarr[i].ck=2;}
			}

			document.getElementById( "wantLink" ).setAttribute( "onClick", "javascript: updateCheckboxes('clearPageWant');lootBoxesNeeded=[];hideContinueButton();" );
			
		}
		if (code == 'checkPageHave'){
			if (displayHeroId ==  itemarr[i].he || displayHeroId == 26){
				if (showItemType(i) && showEvent(i) && showSpecial(i) && showRarity(i)){itemarr[i].ck=1;}
			}	
		}
		if (code == 'clearAllWant'){
			itemarr[i].ck=1;
		}
		if (code == 'clearAllHave'){
			
		}
		if (code == 'checkAllWant'){
			
		}
		if (code == 'checkAllHave'){
			
		}
	}
	updateTable();
	updateDesired();
}


//update the table rows.
function updateTable() {
	var outputstr='';
	var i=0;
	var displayHeroId=heroSelected();
	console.log('hero selected id is '+displayHeroId);
	
	for (i=0;i<itemarr.length;i++) {
		if (displayHeroId ==  itemarr[i].he || displayHeroId == 26) {
			if (showItemType(i) && showEvent(i) && showSpecial(i) && showRarity(i)){
				outputstr+='<tr>'+makeRow(i) +'</tr>';
			}
		}
	}
	document.getElementById("tableBody").innerHTML =outputstr;
}

//update item counters
function updateDesired() {
	var wantArr=calcWantArr();
	var counter=0;
	var i=0;

	document.getElementById("goldNeeded").innerHTML =calcCost(wantArr);

	for (i=0;i<wantArr.length;i++) {
		if (numToRarity(itemarr[wantArr[i]].ra) == 'common') {counter++;}
	}
	document.getElementById("wantedCommons").innerHTML=counter;
	counter=0

	for (i=0;i<wantArr.length;i++) {
		if (numToRarity(itemarr[wantArr[i]].ra) == 'rare') {counter++;}
	}
	document.getElementById("wantedRares").innerHTML=counter;
	counter=0

	for (i=0;i<wantArr.length;i++) {
		if (numToRarity(itemarr[wantArr[i]].ra) == 'epic') {counter++;}
	}
	document.getElementById("wantedEpics").innerHTML=counter;
	counter=0

	for (i=0;i<wantArr.length;i++) {
		if (numToRarity(itemarr[wantArr[i]].ra) == 'legendary') {counter++;}
	}
	document.getElementById("wantedLegs").innerHTML=counter;
	counter=0

	for (i=0;i<wantArr.length;i++) {
		if (itemarr[wantArr[i]].co == 0) {counter++;}
	}
	document.getElementById("wantedIcons").innerHTML=counter;
}
</script>

<script>
//simulation functions!
var wantArrGlobal=[];
var wantCostArrGlobal=[];
//return random integer including entpoints
function intBetween(bot,top){
	return Math.floor(Math.random() * (top - bot + 1) + bot);
}
/*
var probabilities={'common':5866,'rare':2741,'epic':467,'leg':189, 
            'rare-currency':428,'epic-currency':255,'leg-currency':54, 
            'p-event':0.3};
*/

/*
//probabilities of getting each item in percent*100			
var probAdj={'common':5866,'rare':2741,'epic':467,'leg':189, 
            'rare-currency':428,'epic-currency':255,'leg-currency':54, 
            'p-event':0.3};

//adjust probability so that it just increases.
probAdj['rare']=probAdj['rare']+probAdj['common'];
probAdj['epic']=probAdj['epic']+probAdj['rare'];
probAdj['leg']=probAdj['leg']+probAdj['epic'];
probAdj['rare-currency']=probAdj['rare-currency']+probAdj['leg'];
probAdj['epic-currency']=probAdj['epic-currency']+probAdj['rare-currency'];
probAdj['leg-currency']=probAdj['leg-currency']+probAdj['epic-currency'];

*/
//probabilities of getting each item in percent*1000
//common is 0 because it gets adjusted to "fill in"
var probChina={'common':0,'rare':31690,'epic':4545,'leg':1852, 
            'rare-currency':Math.floor(31690/rarebox.length),'epic-currency':Math.floor(4545/epicbox.length),'leg-currency':Math.floor(1852/legbox.length), 
            'p-event':0.3};

probChina['leg'] = probChina['leg']-probChina['leg-currency'];
probChina['epic'] = probChina['epic']-probChina['epic-currency'];
probChina['common'] = 100000 - (probChina['leg'] + probChina['epic'] + probChina['rare'] 
 + probChina['rare-currency'] + probChina['epic-currency'] + probChina['leg-currency']);

			
console.log('pchina'+probChina['rare-currency']);
console.log('pchina'+probChina['epic-currency']);
console.log('pchina'+probChina['leg-currency']);
console.log('pchina'+probChina['leg']);
console.log('pchina'+probChina['epic']);
console.log('pchina'+probChina['rare']);
console.log('pchina'+probChina['common']);
console.log(legbox.length);

var probAdj=probChina;

//adjust probability so that it just increases.
probAdj['rare']=probAdj['rare']+probAdj['common'];
probAdj['epic']=probAdj['epic']+probAdj['rare'];
probAdj['leg']=probAdj['leg']+probAdj['epic'];
probAdj['rare-currency']=probAdj['rare-currency']+probAdj['leg'];
probAdj['epic-currency']=probAdj['epic-currency']+probAdj['rare-currency'];
probAdj['leg-currency']=probAdj['leg-currency']+probAdj['epic-currency'];

//get new item's rarity 
function getNewItemRarity(){
	var rand = intBetween(1,probAdj['epic-currency']);
	var items=['common','rare','epic','leg','rare-currency','epic-currency','leg-currency'];
	for (var i=0; i<items.length;i++){
		if (rand < probAdj[items[i]]){
			return items[i];
		} 
	}
	return 'err';
}

//based on the rarity, get a new item's index
function getNewItemNumber(rarity){
	if (rarity == 'common') {
		return commonbox[intBetween(0,commonbox.length-1)]
	}
	if (rarity == 'rare') {
		return rarebox[intBetween(0,rarebox.length-1)]
	}
	if (rarity == 'epic') {
		return epicbox[intBetween(0,epicbox.length-1)]
	}
	if (rarity == 'leg') {
		return legbox[intBetween(0,legbox.length-1)]
	}
}


//figure out what items the user wants.
function calcWantArr() {
	var outarr=[];
	for (var i=0;i<itemarr.length;i++){
		if (itemarr[i].ck == 2 ) {
			outarr.push(i);
		}
	}
	return outarr;
}
//figure out cost of items the user wants.
function calcCostArr() {
	var outarr=[];
	for (var i=0;i<itemarr.length;i++){
		if (itemarr[i].ck == 2 ) {
			outarr.push(itemarr[i].co);
		}
	}
	return outarr;
}

//figure out what items the user has.
function calcHaveArr() {
	var outarr=[];
	for (var i=0;i<itemarr.length;i++){
		if (itemarr[i].ck == 1 ) {
			outarr.push(i);
		}
	}
	return outarr;
}

//figure out what items the user wants costs
function calcCost(wantArr){
	var cost=0;
	for (var i=0;i<wantArr.length;i++){
		cost += itemarr[wantArr[i]].co; //icons are set to 0
	}
	return cost;
}


function buyStuff(gold,spendingStr) {
	if (spendingStr == 'optimal' || spendingStr == 'buyNone') {return gold;}
	
	if (spendingStr == 'buyLow') {
		//icons are listed as 0 cost
		//http://stackoverflow.com/questions/10557176/minimum-number-excluding-zero
		var minCost=Math.min.apply(null, wantCostArrGlobal.filter(Boolean)); //infinity if all 0's (https://jsfiddle.net/gpLk9ntc/)
		if (isFinite(minCost) && gold >= minCost) {
			wantArrGlobal.splice(wantCostArrGlobal.indexOf(minCost),1);
			wantCostArrGlobal.splice(wantCostArrGlobal.indexOf(minCost),1);
			gold=gold-minCost;
		}
	}
	
	if (spendingStr == 'buyHigh') {
		var maxCost=Math.max.apply(Math,wantCostArrGlobal);
		if (gold >= maxCost && maxCost > 0) {
			wantArrGlobal.splice(wantCostArrGlobal.indexOf(maxCost),1);
			wantCostArrGlobal.splice(wantCostArrGlobal.indexOf(maxCost),1);
			gold=gold-maxCost;
		}
	}
	

return gold;
}


//check if the simulation should be over
function simulationOver(haveArr,gold,spendingStr) {

		var i=0;
		//check if you have all the items you want
		if (wantArrGlobal.includes(haveArr[haveArr.length-1])){
			wantCostArrGlobal.splice(wantArrGlobal.indexOf(haveArr[haveArr.length-1]),1);
			wantArrGlobal.splice(wantArrGlobal.indexOf(haveArr[haveArr.length-1]),1);
		}
		if (wantArrGlobal.length == 0) {return true;}
		
		//check if there is an icon that you do not have
		for (i=0;i<wantArrGlobal.length;i++) { //cost is 0 for icons
			if (itemarr[wantArrGlobal[i]].co == 0) {
				return false;
			} 
		}
		
		//check if gold can buy the remaining items
		if (spendingStr != 'buyNone' && gold >= calcCost(wantArrGlobal)) {
			//console.log('got gold '+gold+' dfsdf '+calcCost(wantArrGlobal));
			return true;
		}
		
		return false;
}




//runs a single simulation to see how many loot boxes
function runSimulation(haveArr,startGold,maxItems,spendingStr) {

	
	var iterationNumber=0;
	var itemRarity='';
	while (simulationOver(haveArr,startGold,spendingStr) == false && iterationNumber < maxItems){
	
		startGold=buyStuff(startGold,spendingStr);
		//console.log(wantArr.length);
		//console.log('start gold '+startGold);
		itemRarity=getNewItemRarity();
		if (itemRarity == 'common' || itemRarity == 'rare' || itemRarity == 'epic' || itemRarity == 'leg')  {
			itemNumber=getNewItemNumber(itemRarity);
			if (haveArr.includes(itemNumber)) { //duplicate
				if (itemRarity == 'common'){ startGold += 5;}
				if (itemRarity == 'rare'){ startGold += 75;}
				if (itemRarity == 'epic'){ startGold += 50;}
				if (itemRarity == 'leg'){ startGold += 200;}
			} else {//not a duplicate
				haveArr.push(itemNumber);
			}
		} else { //got monies
		if (itemRarity == 'rare-currency'){ startGold += 50;}
		if (itemRarity == 'epic-currency'){ startGold += 150;}
		if (itemRarity == 'leg-currency'){ startGold += 500;}
		}
	iterationNumber++;
	}
	//console.log(haveArr);
	return iterationNumber/4;
}

function average(arr){
	var sum=0;
	for (var i=0;i<arr.length;i++) {sum += arr[i];}
	return sum/arr.length;
}

var lootBoxesNeeded=[];

//function to loop through many simulations
function startSimulating(cont) {
	var t0 = performance.now();
	var t2 = performance.now();
	var t3 = performance.now();
	if (!cont) {lootBoxesNeeded=[];}
	var n_iter=Number(document.getElementById("nIterations").value);
	var maxItems=Number(document.getElementById("maxBoxes").value)*4;
	var maxTime=Number(document.getElementById("maxTime").value);
	if (maxTime > 20) {maxTime=20};
	
	// get spending habit
	var spendarr = document.getElementsByName("spend");
	var spendingStr;
	for(var i = 0; i < spendarr.length; i++) {
		if(spendarr[i].checked) {
			spendingStr = spendarr[i].value;}
	}
	
	console.log('spending str = '+spendingStr);
	wantArrGlobal=calcWantArr();
	wantCostArrGlobal=calcCostArr();
	//var wantArr=calcWantArr();
	var haveArr=calcHaveArr();
	console.log(wantArrGlobal);
	console.log(haveArr);
	var startGold=Number(document.getElementById("userGold").value);
	simulation_block: {
		for (var i=0;i<n_iter;i++){
			wantArrGlobal=calcWantArr();
			wantCostArrGlobal=calcCostArr();
			haveArr=calcHaveArr();
			startGold=Number(document.getElementById("userGold").value);
			lootBoxesNeeded.push(runSimulation(haveArr,startGold,maxItems,spendingStr));
			t3 = performance.now();
			//kill if gone too long
			if ((Math.floor(t3 - t0))/1000  > maxTime) {
				break simulation_block;
			}	
		}
	}
	var t1 = performance.now();
	console.log("Call to doSomething took " + (Math.floor(t1 - t0))/1000 + " seconds.");
	//console.log(lootBoxesNeeded);
	outputStatistics(lootBoxesNeeded,(Math.floor(t1 - t0))/1000,i);
	document.getElementById('continueSimulation').style.display = 'inLine';
}

function hideContinueButton() {
	document.getElementById('continueSimulation').style.display = 'none';
	}


function outputStatistics(lootBoxesNeeded,timeTaken,iterations) {
	document.getElementById('simResults').style.display = 'block';
	lootBoxesNeeded.sort(function(a, b){return a-b});
	var sum=0;
	for (var i=0;i<lootBoxesNeeded.length;i++){
		sum += lootBoxesNeeded[i];	
	}
	document.getElementById("boxesNeededAvg").innerHTML=Math.floor(sum/lootBoxesNeeded.length); //
	document.getElementById("boxesNeededMed").innerHTML=Math.floor(lootBoxesNeeded[Math.floor(lootBoxesNeeded.length*0.5)]);
	document.getElementById("timeTaken").innerHTML=timeTaken;
	document.getElementById("nIterationsOut").innerHTML=iterations;
	document.getElementById("boxesNeededRange").innerHTML=Math.round(lootBoxesNeeded[Math.floor(lootBoxesNeeded.length*0.05)])+
		'-'+Math.round(lootBoxesNeeded[Math.floor(lootBoxesNeeded.length*0.95)]);
	
	var postStr='';
	if (lootBoxesNeeded.length < 500) { postStr=postStr+' The total number of iterations completed is very low ('+lootBoxesNeeded.length+').  Click on the "continue simulation" to add more iterations (you want at least ~500, preferably >1000) or increase the time allowed in the simulation options (top of page). ';}
	if (timeTaken > 19) { postStr=postStr+' There is an upper limit of 20 seconds on time allowed.  More than that, pages begin to become "unresponsive".';}
	
	document.getElementById("postSimComment").innerHTML=postStr;
	
	
	var data = [
		  {
			x: lootBoxesNeeded,
			type: 'histogram',
			autobinx: true,
		    nbinsx: 35,
			marker: {
			color: 'rgba(100,250,100,0.7)',
			},
		  },
		];
	var layout = {
	  title: 'Loot Boxes Needed',
	  xaxis: {
		title: 'Loot Boxes Needed to get your items',
		titlefont: {
		  family: 'Courier New, monospace',
		  size: 18,
		  color: '#7f7f7f'
		}
	  },
	  yaxis: {
		title: 'Frequency',
		titlefont: {
		  family: 'Courier New, monospace',
		  size: 18,
		  color: '#7f7f7f'
		}
	  }
	};
	
	Plotly.newPlot('myDiv', data,layout);
	
}


</script>


<script>
//saving cookies and stuff in URL...
//copied from w3schools.com
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function clearCookie(){
	console.log('attempting to clear a cookie');
	setCookie('checked', 'none', -1);
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}



function makeUrl(){
    var outstr='';
    var i=0;
    for (i=0;i<n_items;i++){
        if (itemarr[i].ck !=0 ) {
            outstr+=i+"-"+itemarr[i].ck+",";
        }
        
    }
    outstr = outstr.substring(0, outstr.length - 1);
    document.getElementById("urlArea").innerHTML=
    "<a href='https://billfreeman44.github.io/ow_loot_box_calc/index.html?checked="+outstr+"'>Bookmark this link to save current selection</a>";
	
	//also save to cookies
	//saveSelectedToCookies();
	
}

function saveSelectedToCookies() {
    var outstr='';
    var i=0;
    for (i=0;i<n_items;i++){
        if (itemarr[i].ck !=0 ) {
            outstr+=i+"-"+itemarr[i].ck+",";
        }
        
    }
	//setCookie("checked", outstr.substring(0, outstr.length - 1), 30);
	
	
}

function restoreCookieStuff() {
	console.log('called cookie stuff');
	var cookieStr=getCookie("checked");
	if (cookieStr) {
		var array = cookieStr.split(',');
		var splits;
		for (var i=0;i<array.length;i++){
			splits=array[i].split('-');
			itemarr[splits[0]].ck=splits[1];
		}
	}

}

//get the "checked" variable from the URL
function getChecked()
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == "checked") {
				   console.log('blabla='+pair[1]); 
				   return pair[1];
			   }
       }
       return(false);
}

function updateCheckboxVar() {
	console.log('called updateCheckboxVar stuff');
	var prechecked = getChecked();
	if (prechecked) {
		var array = prechecked.split(',');
		var splits;
		for (var i=0;i<array.length;i++){
			splits=array[i].split('-');
			itemarr[splits[0]].ck=splits[1];
		}
	}
}

//restoreCookieStuff();


</script>

<p>
<table class="sortable" id="withsymbolsbeforesorting"><thead><tr>
<th class='sorttable_nosort'>Have it</th>
<th class='sorttable_nosort'>Want it (<a href="javaScript:void(0);" onclick="updateCheckboxes('checkPageWant');lootBoxesNeeded=[];hideContinueButton();" id='wantLink'>all</a>)</th>
<th style="width: 60px;">Type</th>
<th>Name</th>
<th>Rarity</th>
<th>Event</th>
<th>Special</th>
<th>Cost</th>
<th>Hero</th>
</tr></thead>
<tbody id="tableBody">

</tbody>
<tfoot>
</tfoot>
</table>
</p>
<script>
updateCheckboxVar();
clearCookie();
updateDesired();
updateTable(); //initially create a table w/ ana's items!v
</script>


<script>
// Get the modal
var hmodal = document.getElementById('helpModal');
var fmodal = document.getElementById('filtersModal');
var omodal = document.getElementById('optionsModal');
var smodal = document.getElementById('spendingModal');

// Get the button that opens the modal
var hbtn = document.getElementById("hBtn");
var fbtn = document.getElementById("fBtn");
var obtn = document.getElementById("oBtn");
var sbtn = document.getElementById("sBtn");

// Get the <span> element that closes the modal
var hspan = document.getElementById("hclose");
var fspan = document.getElementById("fclose");
var ospan = document.getElementById("oclose");
var sspan = document.getElementById("sclose");

// When the user clicks on the button, open the modal 
hbtn.onclick = function() {
    hmodal.style.display = "block";
}

fbtn.onclick = function() {
    fmodal.style.display = "block";
}

obtn.onclick = function() {
    omodal.style.display = "block";
}

sbtn.onclick = function() {
    smodal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
hspan.onclick = function() {
	console.log('hspan click');
    hmodal.style.display = "none";
}
fspan.onclick = function() {
    fmodal.style.display = "none";
}
ospan.onclick = function() {
    omodal.style.display = "none";
}
sspan.onclick = function() {
    smodal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == hmodal) {
        hmodal.style.display = "none";
		}
    if (event.target == fmodal) {
        fmodal.style.display = "none";
		}
    if (event.target == omodal) {
        omodal.style.display = "none";
		}
    if (event.target == smodal) {
        smodal.style.display = "none";
		}
}
</script>








<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53666600-2', 'auto');
  ga('send', 'pageview');

</script>






</body> 
</html>

