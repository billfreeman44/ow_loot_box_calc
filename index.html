
<!DOCTYPE HTML PUBLIC> 
<html lang="en"> 
<head> 
<meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0">
  <meta http-equiv="expires" content="Sat, 31 Oct 2014 00:00:00 GMT">
  <meta http-equiv="pragma" content="no-cache">
<script src="sorttable.js"></script>

<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
<title>Item table for Overwatch</title> 
<style>
td {
padding-left: 3px;
padding-right: 7px;
padding-top: 3px;
padding-bottom: 2px;
}
table {
    border-collapse: collapse;
}
table, th, td {
   border: 1px solid black;
	font-size:16px;
}
tr:hover {background-color: #f5f5f5}

table th
{
padding-right:30px;
}

body {
font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
font-size:16px;
line-height:1.42857143;
color:#333;
background-color:#fff;
}

.common  {
color: #3a3a3a ;

}

.rare {
color: #27dcf4 ;

}
.epic  {
color: #f426f0 ;

}

.legendary  {
color: #f4af25 ;

}


</style>
</head> 
<body> 

<p>This is an item table for overwatch.</p> 
<p id='goldbox'> 

Current gold: <input type="number" id="userGold" value="0">

</p><p id='RADIOS' style="column-count: 3"> 

<input type="radio" name="herodisplay" value="1" id="heroNum1" onclick="updateTable();" checked> Ana<br>
<input type="radio" name="herodisplay" value="2" id="heroNum2" onclick="updateTable();"> Bastion<br>
<input type="radio" name="herodisplay" value="3" id="heroNum3" onclick="updateTable();"> Dva<br>
<input type="radio" name="herodisplay" value="4" id="heroNum4" onclick="updateTable();"> Genji<br>
<input type="radio" name="herodisplay" value="5" id="heroNum5" onclick="updateTable();"> Hanzo<br>
<input type="radio" name="herodisplay" value="6" id="heroNum6" onclick="updateTable();"> Junkrat<br>
<input type="radio" name="herodisplay" value="7" id="heroNum7" onclick="updateTable();"> Lucio<br>
<input type="radio" name="herodisplay" value="8" id="heroNum8" onclick="updateTable();"> Mccree<br>
<input type="radio" name="herodisplay" value="9" id="heroNum9" onclick="updateTable();"> Mei<br>
<input type="radio" name="herodisplay" value="10" id="heroNum10" onclick="updateTable();"> Mercy<br>
<input type="radio" name="herodisplay" value="11" id="heroNum11" onclick="updateTable();"> Orisa<br>
<input type="radio" name="herodisplay" value="12" id="heroNum12" onclick="updateTable();"> Pharah<br>
<input type="radio" name="herodisplay" value="13" id="heroNum13" onclick="updateTable();"> Reaper<br>
<input type="radio" name="herodisplay" value="14" id="heroNum14" onclick="updateTable();"> Reinhardt<br>
<input type="radio" name="herodisplay" value="15" id="heroNum15" onclick="updateTable();"> Roadhog<br>
<input type="radio" name="herodisplay" value="16" id="heroNum16" onclick="updateTable();"> Soldier-76<br>
<input type="radio" name="herodisplay" value="17" id="heroNum17" onclick="updateTable();"> Sombra<br>
<input type="radio" name="herodisplay" value="18" id="heroNum18" onclick="updateTable();"> Symmetra<br>
<input type="radio" name="herodisplay" value="19" id="heroNum19" onclick="updateTable();"> Torbjorn<br>
<input type="radio" name="herodisplay" value="20" id="heroNum20" onclick="updateTable();"> Tracer<br>
<input type="radio" name="herodisplay" value="21" id="heroNum21" onclick="updateTable();"> Widowmaker<br>
<input type="radio" name="herodisplay" value="22" id="heroNum22" onclick="updateTable();"> Winston<br>
<input type="radio" name="herodisplay" value="23" id="heroNum23" onclick="updateTable();"> Zarya<br>
<input type="radio" name="herodisplay" value="24" id="heroNum24" onclick="updateTable();"> Zenyatta<br>
<input type="radio" name="herodisplay" value="25" id="heroNum25" onclick="updateTable();"> All Heroes (icons and sprays) <br>
<input type="radio" name="herodisplay" value="25" id="heroNum26" onclick="updateTable();"> Show everything<br>

</p><p id='demo3'> 
<input type="checkbox" id="showSkins" onclick="updateTable();" checked> Show Skins <br>
<input type="checkbox" id="showEmotes" onclick="updateTable();" checked> Show Emotes <br>
<input type="checkbox" id="showIntros" onclick="updateTable();" checked> Show Highlight Intros <br>
<input type="checkbox" id="showPoses" onclick="updateTable();" checked> Show Victory Poses <br>
<input type="checkbox" id="showVoices" onclick="updateTable();" checked> Show Voice Lines <br>
<input type="checkbox" id="showSprays" onclick="updateTable();"> Show Sprays <br>
<input type="checkbox" id="showIcons" onclick="updateTable();"> Show Icons <br>
<br>

<input type="checkbox" id="showNonEvent" onclick="updateTable();" checked> Show Non-event items <br>
<input type="checkbox" id="showUprising" onclick="updateTable();"> Show Uprising <br>
<input type="checkbox" id="showEvents" onclick="updateTable();"> Show Other events <br>

<br>

<input type="checkbox" id="showAchievement" onclick="updateTable();"> Show Achievement items <br>
<input type="checkbox" id="showBlizzcon" onclick="updateTable();"> Show Items from Blizzcon <br>
<input type="checkbox" id="showDefaultItems" onclick="updateTable();"> Show Default items <br>
<input type="checkbox" id="showNormals" onclick="updateTable();" checked> Show Normal items <br>

</p>
<p id='testGetItem'> </p>
<button onclick="buttonPush()">Get an item bro</button><br><br>
<button onclick="clearCookie()">Clear Cookie</button><br><br>

<p id='urlArea'> url area </p>
<div id="myDiv"></div>

<script src="item_output.js"></script>
<script>
//table display and selection functions!
var n_items=itemarr.length;

//stuff for checkboxes
//keeps same as checked and disables button
function toggleCheck(checkId,thisId) {
    document.getElementById(checkId).checked = document.getElementById(thisId).checked;
    document.getElementById(checkId).disabled = document.getElementById(thisId).checked;
}

//keeps same as checked and does not disable button
function checkMatch(checkId,thisId) {
    document.getElementById(checkId).checked = document.getElementById(thisId).checked;
}

function addCheckItemArr(num,code){
	itemarr[num].ck=code;
}

function numToRarity(num) {
	if (num == 0){return '-';}
	var rarities=['common','rare','epic','legendary'];
	return rarities[num-1];

}

function numToType(num) {
	var types=['unknown','icons','sprays','skins','emotes','intros','voicelines','poses'];
	return types[num];
}
function numToEvent(num) {
	var events=['-','Halloween-16','Summer-16','Uprising-17','Winter-16','Rooster-17'];
	return events[num]
}
function numToHero(num) {
	var heroes=['error','ana','bastion','dva','genji',
            'hanzo','junkrat','lucio','mccree',
            'mei','mercy','orisa','pharah','reaper',
            'reinhardt','roadhog','soldier-76','sombra',
            'symmetra','torbjorn','tracer','widowmaker',
            'winston','zarya','zenyatta','all'];
	return heroes[num];
}

//num 1 = achivement (1 achievement, 2 blizzcon)
//2 = is default bool
function numToSpecial(num1,num2) {
	if (num1 == 1) {
	return 'Achievement';
	}
	if (num1 == 2) {
	return 'Blizzcon';
	}
	if (num2 == 1) {
	return 'Default';
	}
	return '-';
}

//inputs are default, achievement, itemNumber, event, have (1=have,0=want)
function outputCheckBox(def,ach,num,eve,hav) {
	var outstr='<input type="checkbox"';
	//its a default item
	if (def) {
		if (hav) {
		outstr+=' id="h'+num+'"';
		} else {
		outstr+=' id="w'+num+'"';
		}
		outstr+=' disabled="true" checked>';
		return outstr;
	}
	
	//its from an achievement
	if (ach) {
		if (hav) {
			outstr+=' id="h'+num+'"';
			outstr+=' onclick="checkMatch(\'w'+num+'\',\'h'+num+'\');makeUrl()"';
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		} else {
			outstr+=' id="w'+num+'"';
			outstr+=' disabled="true"'; 
			
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		}
		return outstr;
	}
	
	//normal item
	if (eve == 0 || eve == 3) {
		if (hav) {
			outstr+=' id="h'+num+'"';
			outstr+=' onclick="toggleCheck(\'w'+num+'\',\'h'+num+'\');addCheckItemArr('+num+',1);makeUrl();"';
			if (itemarr[num].ck == 1) {
				outstr+=' checked>';
			} else {
				outstr+='>';
			}
		} else {
			outstr+=' id="w'+num+'" onclick="addCheckItemArr('+num+',2);makeUrl()"';
			if (itemarr[num].ck == 1) {
				outstr+=' disabled="true" checked>';
			} else { 
				if ( itemarr[num].ck == 2){
					outstr+=' checked>';
					} else {
						outstr+='>';
					}
				}
			}
			return outstr;
	} 
	
	//other events
	if (hav) {
		outstr+=' id="h'+num+'"';
		outstr+=' onclick="checkMatch(\'w'+num+'\',\'h'+num+'\');makeUrl()"';
		if (itemarr[num].ck == 1) {
			outstr+=' checked>';
		} else {
			outstr+='>';
		}
	
	} else {
		outstr+=' id="w'+num+'"';
		outstr+=' disabled="true"';
		if (itemarr[num].ck == 1 || itemarr[num].ck == 2) {
			outstr+=' checked>';
		} else {
			outstr+='>';
		}
	
	}
	return outstr;

}



function makeRow(itemNumber) {
	var outputstr='';
	console.log('making row for '+itemNumber)
	outputstr+="<td>"+outputCheckBox(itemarr[itemNumber].de,itemarr[itemNumber].ac,
	itemNumber,itemarr[itemNumber].ev,true)+"</td>";
	outputstr+="<td>"+outputCheckBox(itemarr[itemNumber].de,itemarr[itemNumber].ac,
	itemNumber,itemarr[itemNumber].ev,false)+"</td>";
	outputstr+="<td>"+numToType(itemarr[itemNumber].ty)+"</td>";
	outputstr+="<td class='"+numToRarity(itemarr[itemNumber].ra)+"'>"+itemarr[itemNumber].na+"</td>";
	outputstr+="<td>"+numToRarity(itemarr[itemNumber].ra)+"</td>";
	outputstr+="<td>"+numToEvent(itemarr[itemNumber].ev)+"</td>";
	outputstr+="<td>"+numToSpecial(itemarr[itemNumber].ac,itemarr[itemNumber].de)+"</td>";
	outputstr+="<td>"+itemarr[itemNumber].co+"</td>";
	outputstr+="<td>"+numToHero(itemarr[itemNumber].he)+"</td>";
	return outputstr;
}





function heroSelected() {
	for (var i=1;i<27;i++) {
		console.log(i);
		if (document.getElementById('heroNum'+i).checked == true) {
		return i;
		}
	}
	console.log('there was an invalid hero selected... defaulting to displaying ana!');
	return 1; //error!!
}




//return true if item should be shown based on its type
function showItemType(i) {
	var typestr=numToType(itemarr[i].ty);
	if (typestr == 'icons' && document.getElementById('showIcons').checked == true) {
		return true;
	}
	if (typestr == 'sprays' && document.getElementById('showSprays').checked == true) {
		return true;
	}
	if (typestr == 'skins' && document.getElementById('showSkins').checked == true) {
		return true;
	}
	if (typestr == 'emotes' && document.getElementById('showEmotes').checked == true) {
		return true;
	}
	if (typestr == 'intros' && document.getElementById('showIntros').checked == true) {
		return true;
	}
	if (typestr == 'voicelines' && document.getElementById('showVoices').checked == true) {
		return true;
	}
	if (typestr == 'poses' && document.getElementById('showPoses').checked == true) {
		return true;
	}
	return false;
}

//return true if item should be shown based on its event
function showEvent(i) {
	var eventstr=numToEvent(itemarr[i].ev);
	if (eventstr == 'Uprising-17' && document.getElementById('showUprising').checked == true) {
		return true;
	}
	if (eventstr != '-' && eventstr != 'Uprising-17' && document.getElementById('showEvents').checked == true) {
		return true;
	}
	if (eventstr == '-' && document.getElementById('showNonEvent').checked == true) {
		return true;
	}
	return false;
}

//return true if item should be shown based on its achievement or blizcon or default
function showSpecial(i) {
	var specialstr=numToSpecial(itemarr[i].ac,itemarr[i].de);
	if (specialstr == 'Blizzcon' && document.getElementById('showBlizzcon').checked == true) {
		return true;
	}
	if (specialstr == 'Achievement' && document.getElementById('showAchievement').checked == true) {
		return true;
	}
	if (specialstr == 'Default' && document.getElementById('showDefaultItems').checked == true) {
		return true;
	}
	if (specialstr == '-' && document.getElementById('showNormals').checked == true) {
		return true;
	}
	
	
	return false;
}





function updateTable() {
	var outputstr='';
	var i=0;
	var displayHeroId=heroSelected();
	console.log('hero selected id is '+displayHeroId);
	
	for (i=0;i<n_items;i++) {
		if (displayHeroId ==  itemarr[i].he || displayHeroId == 26) {
			if (showItemType(i) && showEvent(i) && showSpecial(i)){
				outputstr+='<tr>'+makeRow(i) +'</tr>';
			}
		}
	
	}
	
	
	
	document.getElementById("tableBody").innerHTML =outputstr;

}



</script>




<script>
//simulation functions!

//return random integer including entpoints
function intBetween(bot,top){
	return Math.floor(Math.random() * (top - bot + 1) + bot);
}

var probabilities={'common':5866,'rare':2741,'epic':467,'leg':189, 
            'rare-currency':428,'epic-currency':255,'leg-currency':54, 
            'p-event':0.3};
			
var probAdj={'common':5866,'rare':2741,'epic':467,'leg':189, 
            'rare-currency':428,'epic-currency':255,'leg-currency':54, 
            'p-event':0.3};
			
probAdj['rare']=probAdj['rare']+probAdj['common'];
probAdj['epic']=probAdj['epic']+probAdj['rare'];
probAdj['leg']=probAdj['leg']+probAdj['epic'];
probAdj['rare-currency']=probAdj['rare-currency']+probAdj['leg'];
probAdj['epic-currency']=probAdj['epic-currency']+probAdj['rare-currency'];
probAdj['leg-currency']=probAdj['leg-currency']+probAdj['epic-currency'];


function getNewItemNumber(rarity){
	if (rarity == 'common') {
		return commonbox[intBetween(0,commonbox.length-1)]
	}
	if (rarity == 'rare') {
		return rarebox[intBetween(0,rarebox.length-1)]
	}
	if (rarity == 'epic') {
		return epicbox[intBetween(0,epicbox.length-1)]
	}
	if (rarity == 'leg') {
		return legbox[intBetween(0,legbox.length-1)]
	}
	

}


function getNewItemRarity(){
	var rand = intBetween(1,probAdj['epic-currency']);
	var items=['common','rare','epic','leg','rare-currency','epic-currency','leg-currency'];
	for (var i=0; i<items.length;i++){
		if (rand < probAdj[items[i]]){
			return items[i];
		} 
	}
	return 'err';
}

function buttonPush(){
	var rarity=getNewItemRarity();
	var itemNumber=-1; 
	if (rarity == 'common' || rarity == 'rare' || rarity == 'epic' || rarity == 'leg') {
		itemNumber=getNewItemNumber(rarity);
		document.getElementById("testGetItem").innerHTML = rarity+' '+itemarr[itemNumber].na3;
		return
	}
	document.getElementById("testGetItem").innerHTML = rarity;
}




</script>


<script>
//saving cookies and stuff in URL...
//copied from w3schools.com
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function clearCookie(){
	setCookie('none', 'none', -1);
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function checkCookie() {
    var user = getCookie("username");
    if (user != "") {
        alert("Welcome again " + user);
    } else {
        user = prompt("Please enter your name:", "");
        if (user != "" && user != null) {
            setCookie("username", user, 365);
        }
    }
}


function makeUrl(){
    var outstr='';
    var i=0;
    for (i=0;i<n_items;i++){
        if (itemarr[i].ck !=0 ) {
            outstr+=i+"-"+itemarr[i].ck+",";
        }
        
    }
    outstr = outstr.substring(0, outstr.length - 1);
    document.getElementById("urlArea").innerHTML=
    "<a href='https://billfreeman44.github.io/ow_loot_box_calc/index.html?checked="+outstr+"'>save this to bookmarks to save what items are checked</a>";
	
	//also save to cookies
	saveSelectedToCookies();
	
}

function saveSelectedToCookies() {
    var outstr='';
    var i=0;
    for (i=0;i<n_items;i++){
        if (itemarr[i].ck !=0 ) {
            outstr+=i+"-"+itemarr[i].ck+",";
        }
        
    }
	setCookie("checked", outstr.substring(0, outstr.length - 1), 30);
	
	
}

function restoreCookieStuff() {
	console.log('called cookie stuff');
	var cookieStr=getCookie("checked");
	if (cookieStr) {
		var array = cookieStr.split(',');
		var splits;
		for (var i=0;i<array.length;i++){
			splits=array[i].split('-');
			itemarr[splits[0]].ck=splits[1];
		}
	}

}





//get the "checked" variable from the URL
function getChecked()
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == "checked") {
				   console.log('blabla='+pair[1]); 
				   return pair[1];
			   }
       }
       return(false);
}

function updateCheckboxVar() {
	console.log('called updateCheckboxVar stuff');
	var prechecked = getChecked();
	if (prechecked) {
		var array = prechecked.split(',');
		var splits;
		for (var i=0;i<array.length;i++){
			splits=array[i].split('-');
			itemarr[splits[0]].ck=splits[1];
		}
	}
}

restoreCookieStuff();
updateCheckboxVar();

</script>

<p>
<table class="sortable" id="withsymbolsbeforesorting"><thead><tr>
<th>Have it</th>
<th>Want it</th>
<th>Type</th>
<th>Name</th>
<th>Rarity</th>
<th>Event</th>
<th>Special</th>
<th>Cost</th>
<th>Hero</th>
</tr></thead>
<tbody id="tableBody">

</tbody>
<tfoot>
</tfoot>
</table>
</p>
<script>
updateTable(); //initially create a table w/ ana's items!
</script>
</body> 
</html>

